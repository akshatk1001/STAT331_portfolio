---
title: "STAT 331 Portfolio"
author: "Akshat Khandelwal"
format: html 
embed-resources: true
layout: margin-left
editor: visual
execute: 
  eval: false
  echo: true
  
code-tools: true
---

[**My Grade:**]{.underline} I believe my grade equivalent to course work evidenced below to be an A-.

[**Learning Objective Evidence:**]{.underline} In the code chunks below, provide code from Lab or Challenge assignments where you believe you have demonstrated proficiency with the specified learning target. Be sure to specify **where** the code came from (e.g., Lab 4 Question 2).

## Working with Data

**WD-1: I can import data from a *variety* of formats (e.g., csv, xlsx, txt, etc.).**

-   `csv` Example 1

```{r}
#| label: wd-1-csv-1

# lab-2-student q1
surveys <- read_csv(here::here("week2", "labs", "data", "surveys.csv"))
```

-   `csv` Example 2

```{r}
#| label: wd-1-csv-2

# lab-3-student q2
teacher_evals <- read_csv(here::here("week3", "labs", "data", "teacher_evals.csv"))
```

-   `xlsx`

```{r}
#| label: wd-1-xlsx

# # PA-4
# library(readxl)
# military <- read_xlsx("gov_spending_per_capita.xlsx",
#                       sheet = "Share of Govt. spending",
#                       skip  = 7,
#                       n_max = 190,
#                       na = c("xxx",". .","..")
#                       )
```

**WD-2: I can select necessary columns from a dataset.**

-   Example selecting specified columns
-   *You should have returns to break up the long lines in your code! Anything over 80 characters should have a line break!*

```{r}
#| label: wd-2-ex-1

# Challenge 3 q1
teacher_evals_compare <- teacher_evals %>% 
  filter(question_no == 903) %>% 
  mutate(
  SET_level = if_else(SET_score_avg >= 4, 
                      "excellent", 
                      "standard"),
  sen_level = case_when(seniority <= 4 ~ "junior", 
                        seniority <= 8 ~ "senior", 
                        TRUE ~ "very senior")
  ) %>%
#RIGHT HERE (BELOW) --->
  select(course_id, 
         SET_level, 
         sen_level)
```

-   Example removing specified columns

```{r}
#| label: wd-2-ex-2

# lab-5-student-modified
suspect_info <- gym_people_names %>% 
  left_join(drivers_license, join_by(license_id == id)) %>% 
  select(
    name = name.x, 
    gender, 
    height, 
    plate_number, 
    car_make, 
    car_model
  )
```

-   Example selecting columns based on logical values (e.g., `starts_with()`, `ends_with()`, `contains()`, `where()`)
-   *Specifically, I would love to see you using named argments and the correct function syntax for the if_any() function:*

```{r}
#| label: wd-2-ex-3

# lab-3-question-8 (modified, still same result)
teacher_evals_clean %>%
  filter(if_any(.cols = where(is.numeric), .fns = ~ is.na(.x))) %>%
  summarize(
    teacher_id = unique(teacher_id),
    course_id = unique(course_id)
  )

names(which(colSums(is.na(teacher_evals_clean)) > 0))
```

**WD-3: I can filter rows from a dataframe for a *variety* of data types (e.g., numeric, integer, character, factor, date).**

-   Numeric Example 1
-   *You should only call the filter() function once!*

```{r}
#| label: wd-3-numeric-ex-1

# lab-3-question-5
teacher_evals_clean <- teacher_evals |>
  rename(sex = gender) |>
# RIGHT HERE 
  filter(
    no_participants >= 10, 
    !is.na(no_participants)
    ) |>
  select(
    course_id, teacher_id, question_no, no_participants, resp_share,
    SET_score_avg, percent_failed_cur, academic_degree, seniority, sex
    ) |>
  mutate (
    across(c(teacher_id, question_no, no_participants, seniority), as.integer)
  )
```

-   Numeric Example 2

```{r}
#| label: wd-3-numeric-ex-2

# lab-4-question-5
income_table <- ca_childcare |>
   # RIGHT HERE
  filter(study_year %in% c(2008, 2018)) |>
  group_by(region, study_year) |>
  summarize(median_income = median(mhi_2018, na.rm = TRUE)) |>
  pivot_wider(names_from = study_year, values_from = median_income) |>
  arrange(desc(`2018`))

income_table

```

-   Character Example 1 (any context)

```{r}
#| label: wd-3-character

# lab-4-question-2
ca_childcare <-
  left_join(x = childcare_costs,
            y = counties,
            by = "county_fips_code") |>
  filter(state_name == "California")
  
ca_childcare 
```

-   Character Example 2 (example must use functions from **stringr**)
-   *Is there a way you can get the max \*and\* min in \*\*one\*\* pipeline?*

```{r}
#| label: wd-3-string

# lab-5-Finding the first and second witnesses
northwestern_witness <- person %>%
    filter(address_street_name == "Northwestern Dr") %>%
    slice_max(order_by = address_number, n = 1)

northwestern_witness

annabel <- person %>%
    filter(
        address_street_name == "Franklin Ave",
        str_detect(name, regex("^Annabel", ignore_case = TRUE))
    )

annabel
```

-   Date (example must use functions from **lubridate**)

```{r}
#| label: wd-3-date

#lab-5-Crime Scene Report
note <- crime_scene_report %>% 
  mutate(date = ymd(date)) %>% 
  # RIGHT HERE
  filter(
    date == ymd("2018-01-15"),
    type == "murder",
    city == "SQL City"
  ) %>% 
  arrange(date) %>% 
  pull(description)

note
```

**WD-4: I can modify existing variables and create new variables in a dataframe for a *variety* of data types (e.g., numeric, integer, character, factor, date).**

-   Numeric Example 1

```{r}
#| label: wd-4-numeric-ex-1

# lab-3-question-5
teacher_evals_clean <- teacher_evals |>
  rename(sex = gender) |>
  filter(
    no_participants >= 10, 
    !is.na(no_participants)
    ) |>
  select(
    course_id, teacher_id, question_no, no_participants, resp_share,
    SET_score_avg, percent_failed_cur, academic_degree, seniority, sex
    ) |>
  # RIGHT HERE
  mutate (
    across(c(teacher_id, question_no, no_participants, seniority), as.integer)
  )
```

-   Numeric Example 2

```{r}
#| label: wd-4-numeric-ex-2

#lab-10-question-2
results |>
  enframe(name = "simulation", value = "num_correct") |>
  count(num_correct) |>
  mutate(prop = n / sum(n)) |>
  select(num_correct, prop) |>
  gt() |>
  cols_label(
    num_correct = "Number of Babies Correctly Matched",
    prop = "Proportion"
  ) |>
  fmt_percent(columns = prop, decimals = 2)

```

-   Factor Example 1 (renaming levels)

```{r}
#| label: wd-4-factor-ex-1

# lab-4-question-4
ca_childcare <- ca_childcare |> 
  mutate(county_name = str_remove(county_name, " County"),
         # RIGHT HERE
         region = fct_collapse(
           .f = county_name,
           "Superior California"          = superior_counties,
           "North Coast"                  = north_coast_counties,
           "San Francisco Bay Area"       = san_fran_counties,
           "Northern San Joaquin Valley"  = n_san_joaquin_counties,
           "Central Coast"                = central_coast_counties,
           "Southern San Joaquin Valley"  = s_san_joaquin_counties,
           "Inland Empire"                = inland_counties,
           "Los Angeles"                  = la_county,
           "Orange County"                = orange_county,
           "San Diego-Imperial"           = san_diego_imperial_counties
           )
         )
```

-   Factor Example 2 (reordering levels)

```{r}
#| label: wd-4-factor-ex-2

# lab-40question-7

ggplot(
    childcare_age_df,
    aes(
        x = study_year,
        y = price,
        # RIGHT HERE
        color = fct_reorder2(.f = region, .x = study_year, .y = price)
    )
```

-   Character (example must use functions from **stringr**)

```{r}
#| label: wd-4-string

# lab-8-q3
# https://rlang.r-lib.org/reference/englue.html
create_boxplot <- function(data, x_var, y_var) {
  x_label <- englue("{{ x_var }}") |> 
    str_replace_all("_", " ") |> 
    str_to_title()
  
  y_label <- englue("{{ y_var }}") |> 
    str_replace_all("_", " ") |> 
    str_to_title()
  
  plot_title <- paste(y_label, "by", x_label)

```

-   Date (example must use functions from **lubridate**)

```{r}
#| label: wd-4-date

#lab-5-Crime Scene Report
note <- crime_scene_report %>% 
  mutate(date = ymd(date)) %>% 
  filter(
    date == ymd("2018-01-15"),
    type == "murder",
    city == "SQL City"
  ) %>% 
  arrange(date) %>% 
  pull(description)

note
```

**WD-5: I can use mutating joins to combine multiple dataframes.**

-   `left_join()` Example 1

```{r}
#| label: wd-5-left-ex-1

# lab-4-student-2
ca_childcare <- childcare_costs |> 
  left_join(
    counties, 
    by = "county_fips_code"
    ) |> 
  filter(state_name == "California")

ca_childcare
```

-   `right_join()` Example 1

```{r}
#| label: wd-5-right

# lab-5-modified
gym_people_names <- person %>% 
  right_join(
      gym_people, 
      by = c("id" = "person_id")
  )

gym_people_names
```

-   `left_join()` **or** `right_join()` Example 2

```{r}
#| label: wd-5-left-right-ex-2

# lab-5
gym_people_names <- gym_people %>% 
  left_join(
      person, 
      by = c("person_id" = "id")
  )

gym_people_names
```

-   `inner_join()` Example 1

```{r}
#| label: wd-5-inner-ex-1

# lab-5
responsible <- person %>% 
  inner_join(
    concert_goers,
    by = c("id" = "person_id")
    ) %>% 
  inner_join(
    drivers_license,
    by = c("license_id" = "id")
    ) %>% 
  inner_join(
    income, 
    by = "ssn"
    ) %>% 
  filter(
    gender == "female",
    height >= 65,
    height <= 67,
    hair_color == "red",
    car_make == "Tesla",
    car_model == "Model S"
  ) %>% 
  select(name, hair_color, car_make, car_model, height, annual_income)

responsible
```

-   `inner_join()` Example 2

```{r}
#| label: wd-5-inner-ex-2

# lab-5-find-resposible
miranda <- person %>%
    inner_join(
      interview,
      by = c("id" = "person_id")
      ) %>%
    filter(name == "Miranda Priestly") %>%
    select(name, transcript)
```

**WD-6: I can use filtering joins to filter rows from a dataframe.**

-   `semi_join()`

```{r}
#| label: wd-6-semi

# challenge-4-modified
top_counties_df <- price_summary |>
    filter(`care setting` == "Care Center") |>
    slice_max(median_price, n = 15)

# Use semi_join to filter price_summary to only include the top 15 counties
price_summary |>
    semi_join(top_counties_df, by = "county_name") |>
    ggplot(aes(
        x = reorder(county_name, median_price),
        y = median_price,
        fill = `care setting`
    )) +
```

-   `anti_join()`

```{r}
#| label: wd-6-anti

# lab-5-modified
non_suspects <- get_fit_now_member %>% 
  filter(
    !str_detect(id, "^48Z"),
    membership_status == "gold"
  )

gym_people <- get_fit_now_member %>% 
  filter(membership_status == "gold") %>% 
  anti_join(non_suspects, by = "id")

gym_people

gym_people_names <- gym_people %>% 
  left_join(person, by = c("person_id" = "id"))

gym_people_names
```

**WD-7: I can pivot dataframes from long to wide and visa versa**

-   `pivot_longer()`

```{r}
#| label: wd-7-long

#challenge-4
ca_preschool <- ca_childcare |>
    select(
        county_name,
        study_year,
        mc_preschool,
        mfcc_preschool
    ) |>
    # RIGHT HERE
    pivot_longer(
        cols = c(mc_preschool, mfcc_preschool),
        names_to = "care setting",
        values_to = "price"
    ) |>
    mutate(
        `care setting` = fct_recode(
            `care setting`,
            "Care Center" = "mc_preschool",
            "Family/ In-Home" = "mfcc_preschool"
        ),
        county_name = str_remove(county_name, " County$")
    )
```

-   `pivot_wider()`

```{r}
#| label: wd-7-wide

# challenge-4-edited
price_summary <- ca_preschool |>
    group_by(county_name, `care setting`) |>
    filter(study_year == 2018) |>
    summarize(
        median_price = median(
            price,
            na.rm = TRUE
        ),
        mean_price = mean(
            price,
            na.rm = TRUE
        ),
        min_price = min(
            price,
            na.rm = TRUE
        ),
        max_price = max(
            price,
            na.rm = TRUE
        )
    )

#EDITED THIS IN RIGHT HERE
price_summary_wide <- price_summary |>
    select(county_name, `care setting`, median_price) |>
    pivot_wider(
        names_from = `care setting`,
        values_from = median_price
    )

# Display only the first 10 rows for readability
price_summary_wide |>
    head(10)
```

## Reproducibility

**R-1: I can create professional looking, reproducible analyses using RStudio projects, Quarto documents, and the here package.**

The following assignments satisfy the above criteria:

-   Example 1: lab-2-student.qmd
-   Example 2: lab-3-student.qmd
-   Example 3: lab-7-student.qmd
-   Example 4: challenge-7-student.qmd
-   Example 5: lab-9-student.qmd

**R-2: I can write well documented and tidy code.**

-   Example of **ggplot2** plotting
-   *Technically, the percent() function has been superseded. Meaning, there are other functions you should use instead. Specifically, the label_percent() function has replaced this function.*

```{r}
#| label: r-2-1

# challenge-3-question-2
ggplot(teacher_evals_compare, aes(x = sen_level, fill = SET_level)) +
  geom_bar(position = "fill") +
  labs(
    title = "Evaluation of Teachers' Use of Activities",
    x = "Years of Experience",
    y = NULL,
    fill = "Evaluation Rating"
  ) +
  theme_bw() +
  theme(
    legend.position = "top",
    plot.title = element_text()
  ) +
  scale_fill_manual(values = c("excellent" = "#C7A4D5", "standard" = "#B8915E")) +
  scale_y_continuous(labels = scales::label_percent())
```

-   Example of **dplyr** pipeline

```{r}
#| label: r-2-2

# challenge-3-question-1
teacher_evals_compare <- teacher_evals %>% 
  filter(question_no == 903) %>% 
  mutate(
  SET_level = if_else(SET_score_avg >= 4, 
                      "excellent", 
                      "standard"),
  sen_level = case_when(seniority <= 4 ~ "junior", 
                        seniority <= 8 ~ "senior", 
                        TRUE ~ "very senior")
  ) %>%
  select(course_id, 
         SET_level, 
         sen_level)

teacher_evals_compare
```

-   Example of function formatting

```{r}
#| label: r-2-3

# lab-8-question1
rescale_01 <- function(x) {
    if (!is.numeric(x)) {
        stop("Input vector must be numeric")
    }
    if (length(x) <= 1) {
        stop("Input vector length must be greater than 1")
    }

    range_vals <- range(x, na.rm = TRUE)
    min_val <- range_vals[1]
    max_val <- range_vals[2]

    # Apply the rescaling formula
    (x - min_val) / (max_val - min_val)
}

```

**R-3: I can write robust programs that are resistant to changes in inputs.**

-   Example (any context)

```{r}
#| label: r-3-example

# challenge-4 (used NA to remove missing values)
price_summary <- ca_preschool |>
    group_by(county_name, `care setting`) |>
    filter(study_year == 2018) |>
    summarize(
        median_price = median(
            price,
            na.rm = TRUE
        ),
        mean_price = mean(
            price,
            na.rm = TRUE
        ),
        min_price = min(
            price,
            na.rm = TRUE
        ),
        max_price = max(
            price,
            na.rm = TRUE
        )
    )
```

-   Example (function stops)

```{r}
#| label: r-3-function-stops

# lab-8-question1
rescale_01 <- function(x) {
    if (!is.numeric(x)) {
        stop("Input vector must be numeric")
    }
    if (length(x) <= 1) {
        stop("Input vector length must be greater than 1")
    }

    range_vals <- range(x, na.rm = TRUE)
    min_val <- range_vals[1]
    max_val <- range_vals[2]

    # Apply the rescaling formula
    (x - min_val) / (max_val - min_val)
}
```

## Data Visualization & Summarization

**DVS-1: I can create visualizations for a *variety* of variable types (e.g., numeric, character, factor, date)**

-   At least two numeric variables

```{r}
#| label: dvs-1-num

#lab-4-student-q8
ggplot(
    ca_childcare,
    aes(x = mhi_2018, y = mc_infant)
) +
    geom_point(alpha = 0.6, size = 1.8, color = "steelblue") +
    geom_smooth(method = "lm", color = "black") +
    scale_x_continuous(labels = scales::label_currency()) +
    scale_y_continuous(labels = scales::label_currency()) +
    labs(
        title = "Relationship Between Median Household Income and Infant Childcare Cost in California",
        x = "Median Household Income (2018 Dollars)",
        y = "Median Weekly Infant Childcare Price ($)"
    ) +
    theme_bw()
```

-   At least one numeric variable and one categorical variable

```{r}
#| label: dvs-2-num-cat

#lab-2-question-16
ggplot(data = surveys, 
      mapping = aes(x=weight, y = species)) +
      geom_boxplot(outliers = FALSE) + 
      geom_jitter(color = "steelblue", alpha = 0.5) +
      labs(x = "Weight (g)", 
           y = "Rodent Species",
           title = "Boxplot with Dotplot overlay of weight (grams) by rodent species")
```

-   At least two categorical variables

```{r}
#| label: dvs-2-cat

#challenge-3-question-2
ggplot(teacher_evals_compare, aes(x = sen_level, fill = SET_level)) +
  geom_bar(position = "fill") +
  labs(
    title = "Evaluation of Teachers' Use of Activities",
    x = "Years of Experience",
    y = NULL,
    fill = "Evaluation Rating"
  ) +
  theme_bw() +
  theme(
    legend.position = "top",
    plot.title = element_text()
  ) +
  scale_fill_manual(values = c("excellent" = "#C7A4D5", "standard" = "#B8915E")) +
  scale_y_continuous(labels = scales::label_percent())
```

-   Dates (time series plot)

```{r}
#| label: dvs-2-date

# lab-4-question-7
ggplot(
    childcare_age_df,
    aes(
        x = study_year,
        y = price,
        color = region
    )
) +
    # https://ggplot2.tidyverse.org/reference/facet_wrap.html
    facet_wrap(~age) +
    geom_point(alpha = 0.6, size = 1.5) +
    # https://ggplot2.tidyverse.org/reference/geom_smooth.html
    geom_smooth(aes(group = region), method = "loess") +
    labs(
        title = "Weekly Median Price for Center-Based Childcare ($)",
        x = "Study Year", y = NULL,
        color = "California Region"
    ) +
```

**DVS-2: I use plot modifications to make my visualization clear to the reader.**

-   I can modify my plot theme to be more readable

```{r}
#| label: dvs-2-ex-1

# challenge-2
ggplot(data = surveys, 
      mapping = aes(x=weight, y = species, color = sex)) +
  # https://emilhvitfeldt.github.io/r-color-palettes/discrete/ButterflyColors/anteos_clorinde/
      scale_color_manual(values = c("#784116FF", "#9CB6A9FF", "#ACCFCBFF", "#A8BE74FF", "#BF7417FF")) +
      geom_jitter(alpha = 0.15, size = 0.5) +
      geom_boxplot(outliers = FALSE) + 
      scale_color_paletteer_d("ButterflyColors::junonia_evarete") +
      labs(x = "Weight (g)", 
           y = "Rodent Species",
           title = "Boxplot with Dotplot overlay of weight (grams) by rodent species") +

      # RIGHT HERE ------->
      theme( 
        text = element_text(family = "Times", face = "bold"), # Changing the font to be Times (more elegant/academic)
        plot.title = element_text(hjust = 0.5), # centering the plot title - https://stackoverflow.com/questions/40675778/center-plot-title-in-ggplot2 
        axis.title.y = element_text(margin = margin(r = 15),   # incresae right margin for y-axis so it's not as cramped 
        ),
        legend.position = "top" # move legend to top to take up less space
      )
```

-   I can modify my colors to be accessible to anyone's eyes

```{r}
#| label: dvs-2-ex-2

# challenge-2
ggplot(data = surveys, 
      mapping = aes(x=weight, y = species, color = sex)) +
      geom_jitter(alpha = 0.15, size = 0.5) +
      geom_boxplot(outliers = FALSE) + 

      # RIGHT HERE -------->
      scale_color_viridis_d() + # color blind friendly colors library
      labs(x = "Weight (g)", 
           y = "Rodent Species",
           title = "Boxplot with Dotplot overlay of weight (grams) by rodent species") +
```

-   I can modify my plot titles to clearly communicate the data context

```{r}
#| label: dvs-2-ex-3\


# lab-4-questgion-8
ggplot(
    ca_childcare,
    aes(x = mhi_2018, y = mc_infant)
) +
    geom_point(alpha = 0.6, size = 1.8, color = "steelblue") +
    geom_smooth(method = "lm", color = "black") +
    scale_x_continuous(labels = scales::label_dollar()) +
    scale_y_continuous(labels = scales::label_dollar()) +
    labs(
        title = "Relationship Between Median Household Income and Infant Childcare Cost in California",
        x = "Median Household Income (2018 Dollars)",
        y = "Median Weekly Infant Childcare Price ($)"
    ) +
    theme_bw()

```

-   I can modify the text in my plot to be more readable

```{r}
#| label: dvs-2-ex-4

#challenge-4
price_summary |>
    filter(county_name %in% top_counties) |>
    ggplot(aes(
        x = reorder(county_name, median_price),
        y = median_price,
        fill = `care setting`
    )) +
    geom_col(position = "dodge", width = 0.7) +
    coord_flip() +
    scale_y_continuous(
        labels = scales::dollar,
    ) +
    scale_fill_manual(
        values = c(
            "Care Center" = "#E63946",
            "Family/ In-Home" = "#457B9D"
        )
    ) +
    labs(
        title = "Top 15 Most Expensive California Counties for Preschool Care",
        subtitle = "Center-based care costs are consistently more than the cost of family/in-home options (2018)",
        x = "County Name",
        y = "Median Weekly Price",
        fill = "Care Setting",
    ) +
    theme_bw() +
    # RIGHT HERE -------->
    theme(
        text = element_text(family = "Times"),
        plot.title = element_text(face = "bold", size = 14),
        plot.subtitle = element_text(size = 11, color = "gray30"),
        legend.position = "top",
        legend.title = element_text(face = "bold")
    )
```

-   I can reorder my legend to align with the colors in my plot

```{r}
#| label: dvs-2-ex-5

#lab-4-question-7
    mutate(region = fct_reorder2(region, study_year, price))

ggplot(
    childcare_age_df,
    aes(
        x = study_year,
        y = price,
        color = region
    )
) +
    # https://ggplot2.tidyverse.org/reference/facet_wrap.html
    facet_wrap(~age) +
    geom_point(alpha = 0.6, size = 1.5) +
    # https://ggplot2.tidyverse.org/reference/geom_smooth.html
    geom_smooth(aes(group = region), method = "loess") +
    labs(
        title = "Weekly Median Price for Center-Based Childcare ($)",
        x = "Study Year", y = NULL,
        color = "California Region"
    ) +
    theme_bw() +
```

**DVS-3: I show creativity in my visualizations**

-   I can use non-standard colors (Example 1)

```{r}
#| label: dvs-3-1-ex-1

# challenge-2-spicy
ggplot(data = surveys, 
      mapping = aes(x=weight, y = species, color = sex)) +
  # https://emilhvitfeldt.github.io/r-color-palettes/discrete/ButterflyColors/anteos_clorinde/
      scale_color_manual(values = c("#784116FF", "#9CB6A9FF", "#ACCFCBFF", "#A8BE74FF", "#BF7417FF")) +
      geom_jitter(alpha = 0.15, size = 0.5) +
      geom_boxplot(outliers = FALSE) + 
      scale_color_paletteer_d("ButterflyColors::junonia_evarete") +
```

-   I can use non-standard colors (Example 2)

```{r}
#| label: dvs-3-1-ex-2

# challenge-3-question-2
ggplot(teacher_evals_compare, aes(x = sen_level, fill = SET_level)) +
  geom_bar(position = "fill") +
  labs(
    title = "Evaluation of Teachers' Use of Activities",
    x = "Years of Experience",
    y = NULL,
    fill = "Evaluation Rating"
  ) +
  theme_bw() +
  theme(
    legend.position = "top",
    plot.title = element_text()
  ) +
  scale_fill_manual(values = c("excellent" = "#C7A4D5", "standard" = "#B8915E")) +
  scale_y_continuous(labels = scales::label_percent())
```

-   I can use annotations (e.g., `geom_text()`)

```{r}
#| label: dvs-3-2

# challenge-7-q5-modifiied
fish_with_condition <- fish |>
    mutate(condition_index = calculate_condition_index(weight, length)) |>
    filter(!is.na(condition_index))

fish_with_condition |>
    group_by(year, species, section) |>
    summarize(
        mean_condition = mean(condition_index, na.rm = TRUE),
    ) |>
    ggplot(aes(x = year, y = mean_condition, color = species)) +
    geom_line() +
    geom_point(size = 2) +
    # RIGHT HERE --->
    geom_text(aes(label = round(mean_condition, 1)),
            vjust = -0.6,
            size = 3, 
            show.legend = FALSE) +
    facet_wrap(~section) +
    labs(
        title = "Average Fish Condition Index Trends Over Time",
        x = "Year",
        y = "Average Condition Index",
        color = "Species"
    ) +
    theme_minimal() +
    theme(legend.position = "top") +
    scale_color_viridis_d() + # for color-blindness for portfolio
    scale_y_continuous(limits = c(0.7, 1.4), breaks = seq(0.7, 1.4, 0.1))

```

-   I can choose creative geometries (e.g., `geom_segment()`, `geom_ribbon)()`)

```{r}
#| label: dvs-3-3

# lab-4-q8 modified
ggplot(
    ca_childcare,
    aes(x = mhi_2018, y = mc_infant)
) +
    geom_point(alpha = 0.6, size = 1.8, color = "steelblue") +
    geom_rug(alpha = 0.2, color = "gray40") + # geom run with transparency shows where denser areas of data are
    geom_smooth(method = "lm", color = "black") +
    scale_x_continuous(labels = scales::label_dollar()) +
    scale_y_continuous(labels = scales::label_dollar()) +
    labs(
        title = "Relationship Between Median Household Income and Infant Childcare Cost in California",
        x = "Median Household Income (2018 Dollars)",
        y = "Median Weekly Infant Childcare Price ($)"
    ) +
    theme_bw()
```

**DVS-4: I can calculate numerical summaries of variables.**

-   Example using `summarize()`

```{r}
#| label: dvs-4-summarize

# lab-3-q10
teacher_q1_summary <- teacher_evals_clean %>% 
  filter(question_no == 901) %>% 
  group_by(teacher_id) %>% 
  summarize(
    avg_q1 = mean(SET_score_avg),
    num_courses = n_distinct(course_id)
  ) %>% 
  filter(num_courses >= 5) %>% 
  # have to split it up into 2 calls because we have to look after filtering >= 5
  filter(avg_q1 == min(avg_q1) | avg_q1 == max(avg_q1))

teacher_q1_summary
```

-   Example using `across()`

```{r}
#| label: dvs-4-across

#lab-7-q1
missing_vals <- fish |>
    summarize(across(everything(), ~ sum(is.na(.))))

missing_vals
```

**DVS-5: I can find summaries of variables across multiple groups.**

-   Example 1

```{r}
#| label: dvs-5-1

# lab-4-q5
income_table <- ca_childcare |>
    filter(study_year %in% c(2008, 2018)) |>
    group_by(region, study_year) |>
    summarize(median_income = median(mhi_2018, na.rm = TRUE)) |>
    ungroup() |>
    pivot_wider(
        names_from = study_year,
        values_from = median_income,
        names_prefix = "median_income_"
    ) |>
    arrange(desc(median_income_2018))
```

-   Example 2

```{r}
#| label: dvs-5-2

# lab-3-q9
teacher_evals_clean %>% 
  group_by(teacher_id, course_id) %>% 
  summarize(num_questions = n_distinct(question_no)) %>% 
  filter(num_questions == 9) %>% 
  nrow()
```

**DVS-6: I can create tables which make my summaries clear to the reader.**

-   I can modify my column names to clearly communicate the data context

```{r}
#| label: dvs-6-ex-1

# challenege-4
price_summary <- ca_preschool |>
    group_by(county_name, `care setting`) |>
    filter(study_year == 2018) |>
    summarize(
        median_price = median(
            price,
            na.rm = TRUE
        ),
        mean_price = mean(
            price,
            na.rm = TRUE
        ),
        min_price = min(
            price,
            na.rm = TRUE
        ),
        max_price = max(
            price,
            na.rm = TRUE
        )
    )

```

-   I can modify the text in my table to be more readable (e.g., bold face for column headers)

```{r}
#| label: dvs-6-ex-2

#lab-9-q8
fish |> 
  map_int(~sum(is.na(.))) |> 
  enframe(name = "Variable", value = "Missing Values") |> 
  gt() |> 
  tab_header(
    title = "Number of Missing Values for Fish Measurements",
    subtitle = "Data Collected from 1989 to 2006 on the Blackfoot Fish River in Montana"
  ) |> 
  cols_label(
    Variable = "Measurement Variable",
    `Missing Values` = "Missing Values"
  ) |> 
  data_color(
    columns = `Missing Values`,
    fn = function(x) { ifelse(x == 0, "green", "red") }
  )  
```

-   I can arrange my table to have an intuitive ordering

```{r}
#| label: dvs-6-ex-3

# lab-4
income_table <- ca_childcare |>
    filter(study_year %in% c(2008, 2018)) |>
    group_by(region, study_year) |>
    summarize(median_income = median(mhi_2018, na.rm = TRUE)) |>
    ungroup() |>
    pivot_wider(
        names_from = study_year,
        values_from = median_income,
        names_prefix = "median_income_"
    ) |>
    arrange(desc(median_income_2018))

income_table
```

**DVS-7: I show creativity in my tables.**

-   I can use non-default colors

```{r}
#| label: dvs-7-ex-1

#lab-9-q8
fish |> 
  map_int(~sum(is.na(.))) |> 
  enframe(name = "Variable", value = "Missing Values") |> 
  gt() |> 
  tab_header(
    title = "Number of Missing Values for Fish Measurements",
    subtitle = "Data Collected from 1989 to 2006 on the Blackfoot Fish River in Montana"
  ) |> 
  cols_label(
    Variable = "Measurement Variable",
    `Missing Values` = "Missing Values"
  ) |> 
  data_color(
    columns = `Missing Values`,
    fn = function(x) { ifelse(x == 0, "green", "red") }
  ) 
```

-   I can modify the layout of my table to be more readable (e.g., `pivot_longer()` or `pivot_wider()`)

```{r}
#| label: dvs-7-ex-2

#lab-9-q5
evals |> 
  distinct(teacher_id, academic_degree, seniority, sex) |>  
  mutate(
    seniority = case_when(
      seniority <= 4 ~ "Junior",
      seniority > 4 ~ "Senior"
    )
  ) |> 
  pivot_longer(cols = c(academic_degree, seniority, sex),
               names_to = "variable",
               values_to = "level") |> 
  count(variable, level) |> 
  ......
  arrange(variable, level) |> 
  kable(col.names = c("variable", "level", "n", "prop"),
        digits = 7) |> 
  kable_styling(full_width = FALSE,
                bootstrap_options = "striped")

```

## Program Efficiency

**PE-1: I can write concise code which does not repeat itself.**

-   using a single function call with multiple inputs (rather than multiple function calls)

```{r}
#| label: pe-1-one-call

# challenege-4
ca_preschool <- ca_childcare |>
    select(
        county_name,
        study_year,
        mc_preschool,
        mfcc_preschool
    ) |>
    pivot_longer(
        cols = c(mc_preschool, mfcc_preschool),
        names_to = "care setting",
        values_to = "price"
    ) |>
    mutate(
        `care setting` = fct_recode(
            `care setting`,
            "Care Center" = "mc_preschool",
            "Family/ In-Home" = "mfcc_preschool"
        ),
        county_name = str_remove(county_name, " County$")
    )
```

-   using `across()`

```{r}
#| label: pe-1-across

#lab-8-q1
rescale_01 <- function(x) {
    if (!is.numeric(x)) {
        stop("Input vector must be numeric")
    }
    if (length(x) <= 1) {
        stop("Input vector length must be greater than 1")
    }

    range_vals <- range(x, na.rm = TRUE)
    min_val <- range_vals[1]
    max_val <- range_vals[2]

    # Apply the rescaling formula
    (x - min_val) / (max_val - min_val)
}

rescale_column <- function(data, cols) {
  if (!is.data.frame(data)) {
    stop("Input must be a data frame")
  }
  
  data |> 
    mutate(
      #here---------->
      across(
        .cols = {{ cols }}, 
        .fns = ~rescale_01(.x)
        )
    )
}
```

-   using functions from the `map()` family

```{r}
#| label: pe-1-map-1

#lab-10-q1
set.seed(67)

results <- map_int(
              .x = 1:10000,
              .f = ~randomBabies(n_babies = 4)
            )
```

**PE-2: I can write functions to reduce repetition in my code.**

-   Example 1: Function that operates on vectors

```{r}
#| label: pe-2-1

# lab-8-q1
rescale_01 <- function(x) {
    if (!is.numeric(x)) {
        stop("Input vector must be numeric")
    }
    if (length(x) <= 1) {
        stop("Input vector length must be greater than 1")
    }

    range_vals <- range(x, na.rm = TRUE)
    min_val <- range_vals[1]
    max_val <- range_vals[2]

    # Apply the rescaling formula
    (x - min_val) / (max_val - min_val)
}
```

-   Example 2: Function that operates on data frames

```{r}
#| label: pe-2-2

# lab-8-q1
rescale_column <- function(data, cols) {
  if (!is.data.frame(data)) {
    stop("Input must be a data frame")
  }
  
  data |> 
    mutate(across(
      .cols = {{ cols }},
      .fns = ~rescale_01(.x)
      )
    )
}
```

-   Example 3: Function that operates on vectors *or* data frames

```{r}
#| label: pe-2-3

#lab-8-q2
pivot_table <- function(data, row, col) {
  if (!is.data.frame(data)) {
    stop("Input must be a data frame")
  }
  
  data |> 
    count({{ row }}, {{ col }}) |> 
    pivot_wider(
      names_from = {{ col }}, 
      values_from = n, 
      values_fill = 0
      ) |> 
    janitor::adorn_totals(where = c("row", "col"))
}
```

**PE-3:I can use iteration to reduce repetition in my code.**

-   using `across()`

```{r}
#| label: pe-3-across

#lab-3-q5
teacher_evals_clean <- teacher_evals |>
  rename(sex = gender) |>
  filter(
    no_participants >= 10, 
    !is.na(no_participants)
    ) |>
  select(
    course_id, teacher_id, question_no, no_participants, resp_share,
    SET_score_avg, percent_failed_cur, academic_degree, seniority, sex
    ) |>
  mutate (
    across(
      .cols = c(teacher_id, question_no, no_participants, seniority),
      .fns  = as.integer
    )
  )
```

-   using a `map()` function with **one** input (e.g., `map()`, `map_chr()`, `map_dbl()`, etc.)

```{r}
#| label: pe-3-map-1

#lab-9-q2
surveys |> 
  map_chr(class) |> 
  enframe(name = "Variable", value = "Data Type") |> 
  kable()
```

-   using a `map()` function with **more than one** input (e.g., `map_2()` or `pmap()`)

```{r}
#| label: pe-3-map-2

# lab-10-q10
set.seed(331)

ci_dat <- map(
            .x = 1:1000,
            .f = ~mycifun(beta0 = 3, beta1 = 0.5, n = 100)
          )
```

**PE-4: I can use modern tools when carrying out my analysis.**

-   I can use functions which are not superseded or deprecated

```{r}
#| label: pe-4-1

#lab-4-q7

# Stack overflow led me to https://dplyr.tidyverse.org/reference/recode.html but it was
# superceded by https://dplyr.tidyverse.org/reference/case_match.html

childcare_age_df <- ca_childcare %>%
    select(
        county_name,
        region,
        study_year,
        mc_infant,
        mc_toddler,
        mc_preschool
    ) %>%
    pivot_longer(
        cols = c(
            mc_infant,
            mc_toddler,
            mc_preschool
        ),
        names_to = "age",
        values_to = "price"
    ) %>%
    mutate(
        age = case_match(
            age,
            "mc_infant" ~ "Infant",
            "mc_toddler" ~ "Toddler",
            "mc_preschool" ~ "Preschool",
            .default = age
        )
```

-   I can connect a data wrangling pipeline into a `ggplot()`

```{r}
#| label: pe-4-2

# challenege-4
price_summary |>
    filter(county_name %in% top_counties) |>
    ggplot(aes(
        x = reorder(county_name, median_price),
        y = median_price,
        fill = `care setting`
    )) +
```

## Data Simulation & Statisical Models

**DSSM-1: I can simulate data from a *variety* of probability models.**

-   Example 1

```{r}
#| label: dsm-1-1

#lab-10-q4
# define slope and intercept parameters
intercept = 2
slope = 1

# generate x vector
x <- runif(n = 100, min = 0, max = 1)

# generate noise `ep` vector
ep <- rnorm(n = 100, mean = 0, sd = 1)

# generate outcome from population model
y = intercept + (x * slope) + ep

# create an "observed data" dataframe with only the x and y vectors
observed_data <- tibble(x = x, y = y)

```

-   Example 2

```{r}
#| label: dsm-1-2

#lab-10-q1
randomBabies <- function(n_babies){
  correct <- 1:n_babies
  random_assign <- sample(1:n_babies)
  num_correct <- sum(correct == random_assign)
  return(num_correct)
}
```

**DSSM-2: I can conduct common statistical analyses in R.**

-   Example 1

-   *This works, but did you need to make a contingency table? Could you have input these vectors directly into the chisq.test() function?*

```{r}
#| label: dsm-2-1

#challenge-3-q3
chisq.test(
  teacher_evals_compare$SET_level,
  teacher_evals_compare$sen_level
  )
```

-   Example 2

```{r}
#| label: dsm-2-2

#lab04-q9
reg_mod1 <- lm(
  mc_infant ~ mhi_2018, 
  data = ca_childcare
  )
summary(reg_mod1)
```

-   Example 3

```{r}
#| label: dsm-2-3
#lab-2-q17

species_mod <- aov(
  weight ~ species, 
  data = surveys
  )

summary(species_mod)
```

## Revising My Thinking

<!-- How did you revise your thinking throughout the course? How did you revise your thinking on the code examples you have provided in your portfolio? -->

For every single submission, I have revised my code and submission based on the feedback that has been provided. I use this feedback in all my future code too.

<!-- For the revisions included in your Portfolio, to help me understand the nature of your revisions, please denote somehow the feedback I provided you (e.g., boldface, italics, colored text) before your revisions. -->

## Extending My Thinking

<!-- How did you extended your thinking throughout the course? How did you extend your thinking on the code examples you have provided in your portfolio? -->

I used stack overflow and documentation to help me in answering some questions. I feel like this helped me more than ChatGPT because in CS there are always multiple ways to the same problem, and doing this showed me tons of different functions and ways that I could get to the same answer. Throughout my labs and challenges, I attached links to resources that I used to get to my answer. I used a lot of these same functions again in later labs/projects where I recalled them and thought they would be correct to use.

## Peer Support & Collaboration

<!-- Include an image or a description of feedback you gave that you are proud of (either in a peer review or in Discord). -->

![![](images/paste-2.png)](images/paste-1.png)

<!-- Include a description of how you grew as a collaborator through the weekly pair programming activities.   -->

At first in the pair programming activities it was really difficult to me to stop myself from going ahead when I was the computer/typer role. Being a CS major, I feel like I was able to connect some of what I do in my classes/projects to the data analysis tasks and so I was able to process the questions faster than my partner was. However, as we did more pair programming activities I've learned to respect my partner as everyone learns differently and I need to slow down so that my partner can also process their ideas. Also, sometimes their ideas are more efficient than the idea I would've typed out if I was going ahead of them - so it's worth following what they say and then discussing their ideas with them.
